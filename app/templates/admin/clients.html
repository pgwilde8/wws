{% extends "layout/base.html" %}
{% block title %}Admin – Clients{% endblock %}
{% block header %}{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-4 sm:p-6 space-y-5">

  <!-- Page Header -->
  <section class="mb-4">
    <h1 class="text-2xl font-bold text-gray-900">Clients</h1>
    <p class="text-xs text-gray-500 uppercase tracking-wide">Manage clients & integrations</p>
  </section>

  <!-- Search Bar -->
  <div class="bg-white p-3 rounded-xl border shadow-sm">
    <div class="flex flex-wrap gap-3">
      <form method="GET" action="" class="flex flex-wrap gap-2">
        <input
          type="text"
          name="search"
          placeholder="Search clients..."
          value="{{ request.query_params.get('search','') }}"
          class="flex-1 min-w-[240px] border rounded-lg px-3 py-2 text-sm bg-gray-50"
        />
        <button type="submit" class="px-4 py-2 bg-primary text-white text-sm font-semibold rounded-lg hover:opacity-90">
          Search
        </button>
      </form>
      <form method="GET" action="/admin/clients/by-email" class="flex flex-wrap gap-2">
        <input
          type="email"
          name="email"
          placeholder="Jump to email…"
          class="flex-1 min-w-[240px] border rounded-lg px-3 py-2 text-sm bg-gray-50"
          required
        />
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:opacity-90">
          Open
        </button>
      </form>
    </div>
  </div>

  <!-- Clients Grid -->
  <div class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

    {% for client in clients %}
    <div class="bg-white p-4 rounded-2xl border border-gray-200 shadow-sm hover:border-blue-500 transition">
      <a href="/admin/clients/{{ client.id }}" class="block">
        <h2 class="text-sm font-bold text-gray-900">{{ client.name }}</h2>
        <p class="text-xs text-gray-500">ID: {{ client.id }}</p>

        <!-- Integration mini status -->
        <div class="mt-3 space-y-1 text-[10px] font-mono text-gray-600">
          <p>stripe: {{ client.stripe_account_id[:6] + "••" if client.stripe_account_id else "—" }}</p>
          <p>domain: {{ client.live_domain or "—" }}</p>
          <p>support: {% if client.open_support and client.open_support > 0 %}Open {{ client.open_support }}{% else %}None{% endif %}</p>
        </div>

        <div class="mt-3">
          <span class="px-2 py-1 rounded-full bg-gray-100 text-gray-700 text-xs font-semibold">
            {{ client.status|default("active")|title }}
          </span>
        </div>

        <p class="text-[10px] text-gray-400 mt-2">Joined: {{ client.created_at.strftime('%b %d, %Y') if client.created_at else '—' }}</p>
      </a>
    </div>
    {% endfor %}

    {% if not clients %}
    <div class="col-span-full text-center text-gray-500 p-6 text-sm">
      No clients found.
    </div>
    {% endif %}

  </div>

  <!-- Pagination (ready for backend wiring) -->
  <div class="flex justify-center items-center gap-3 text-sm pt-4">
    <button disabled class="px-3 py-1 bg-gray-200 text-gray-500 rounded-lg">Prev</button>
    {% for i in range(1, total_pages+1) %}
    <a href="?page={{ i }}&search={{ request.query_params.get('search','') }}"
       class="px-2 {% if i == page %}text-blue-600 font-bold{% else %}text-gray-500{% endif %}">
      {{ i }}
    </a>
    {% endfor %}
    <button disabled class="px-3 py-1 bg-gray-200 text-gray-500 rounded-lg">Next</button>
  </div>

</div>
{% endblock %}
