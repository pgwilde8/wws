{% extends "layout/base.html" %}
{% block title %}Admin – Webhook Event {{ event.id }}{% endblock %}
{% block header %}{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-4 sm:p-6 space-y-6">

  <!-- Header -->
  <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-200">
    <h1 class="text-xl font-bold text-gray-900">{{ event.event_type }}</h1>
    <p class="text-xs text-gray-500">
      Event ID: {{ event.id }} • Received: {{ event.received_at.strftime('%b %d, %Y %H:%M UTC') }}
    </p>
  </div>

  <!-- Parsed Summary Card -->
  {% if event.summary %}
  <div class="bg-amber-50 p-4 rounded-xl border border-amber-200">
    <h2 class="text-sm font-semibold text-amber-800 mb-2">Event Summary</h2>
    <p class="text-xs text-amber-700 leading-relaxed whitespace-pre-line">
      {{ event.summary }}
    </p>
  </div>
  {% endif %}

  <!-- Webhook Category -->
  <div class="bg-white p-4 rounded-xl border border-gray-200">
    <h2 class="text-sm font-semibold text-gray-700 mb-2">Category</h2>
    <span class="px-3 py-1 rounded-full bg-gray-100 text-gray-800 text-xs font-mono">
      {{ event.category or "—" }}
    </span>
  </div>

  <!-- Client + Project Links -->
  <div class="grid sm:grid-cols-1 md:grid-cols-2 gap-4">

    <div class="bg-white p-4 rounded-xl border border-gray-200">
      <h2 class="text-sm font-semibold text-gray-700 mb-2">Client</h2>
      {% if event.client_id %}
      <a href="/admin/clients/{{ event.client_id }}" class="text-blue-600 text-xs font-semibold hover:underline">
        View Client →
      </a>
      {% else %}
      <p class="text-xs text-gray-500">—</p>
      {% endif %}
    </div>

    <div class="bg-white p-4 rounded-xl border border-gray-200">
      <h2 class="text-sm font-semibold text-gray-700 mb-2">Project</h2>
      {% if event.project_id %}
      <a href="/admin/projects/{{ event.project_id }}" class="text-blue-600 text-xs font-semibold hover:underline">
        View Project →
      </a>
      {% else %}
      <p class="text-xs text-gray-500">General</p>
      {% endif %}
    </div>

  </div>

  <!-- Stripe Account ID -->
  <div class="bg-white p-4 rounded-xl border border-gray-200">
    <h2 class="text-sm font-semibold text-gray-700 mb-2">Stripe Account</h2>
    <p class="font-mono text-xs text-gray-900 bg-gray-50 p-2 rounded-lg border border-gray-100 overflow-x-auto">
      {{ event.stripe_account or "—" }}
    </p>
  </div>

  <!-- Webhook JSON Payload -->
  <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">
    <div class="bg-gray-900 px-4 py-2">
      <h2 class="text-xs font-semibold text-gray-100 tracking-wider uppercase">Raw Payload</h2>
    </div>

    <pre class="text-[11px] sm:text-xs font-mono text-gray-900 bg-gray-50 p-4 overflow-x-auto leading-relaxed whitespace-pre">
{{ event.raw_json }}
    </pre>
  </div>

  <!-- Action Panel -->
  <div class="bg-white p-4 rounded-xl border border-gray-200">
    <h2 class="text-sm font-semibold text-gray-700 mb-3">Actions</h2>

    <div class="flex flex-wrap gap-3">
      <button onclick="navigator.clipboard.writeText(document.getElementById('payloadCopy').textContent)"
              class="px-3 py-1 rounded-full bg-primary hover:opacity-90 text-white text-xs font-semibold">
        Copy Payload
      </button>

      <a href="/admin/stripe/webhooks"
         class="px-3 py-1 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs font-semibold">
        Back to Events
      </a>
    </div>
  </div>

  <!-- Hidden copy source -->
  <div id="payloadCopy" class="hidden">{{ event.raw_json }}</div>

</div>
{% endblock %}
