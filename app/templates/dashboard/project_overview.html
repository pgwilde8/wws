{% extends "layout/base.html" %}
{% block header %}{% endblock %}
{% block footer %}{% endblock %}
{% block title %}Project Overview – {{ project.name }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto p-4 sm:p-6 space-y-6">

  <!-- Project Header -->
  <header class="bg-white p-5 rounded-2xl shadow-sm border border-gray-200">
    <h1 class="text-xl sm:text-2xl font-extrabold text-gray-900">{{ project.name }}</h1>
    <p class="text-xs sm:text-sm text-gray-500 mt-1 capitalize">
      Status: {{ project.status.value.replace('_',' ') }}  
      {% if project.target_date %} • Target: {{ project.target_date.strftime('%b %d, %Y') }}{% endif %}
      {% if project.completed_date %} • Completed: {{ project.completed_date.strftime('%b %d, %Y') }}{% endif %}
    </p>
  </header>

  <!-- Budget & Timeline -->
  <section class="grid sm:grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-white border p-4 rounded-xl shadow-sm">
      <span class="text-xs text-gray-400 uppercase tracking-wide">Budget</span>
      <div class="text-lg font-bold text-gray-900">${{ project.total_budget or "—" }}</div>
    </div>
    <div class="bg-white border p-4 rounded-xl shadow-sm">
      <span class="text-xs text-gray-400 uppercase tracking-wide">Start Date</span>
      <div class="text-sm text-gray-700">{{ project.start_date.strftime('%b %d, %Y') if project.start_date else "—" }}</div>
    </div>
    <div class="bg-white border p-4 rounded-xl shadow-sm">
      <span class="text-xs text-gray-400 uppercase tracking-wide">Target Launch</span>
      <div class="text-sm text-gray-700">{{ project.target_date.strftime('%b %d, %Y') if project.target_date else "—" }}</div>
    </div>
  </section>

  <!-- Milestones -->
  <section class="bg-white border p-5 rounded-2xl shadow-sm">
    <h2 class="text-lg font-bold text-gray-900 mb-3">Milestones</h2>
    <ul class="divide-y divide-dashed text-sm">
      {% for m in project.milestones %}
      <li class="py-2 flex justify-between items-center">
        <span class="text-gray-900 font-medium">{{ m.name }}</span>
        <span class="text-xs font-bold px-2 py-1 rounded-full
          {% if m.status == 'completed' %}bg-green-100 text-green-700
          {% elif m.status == 'in_progress' %}bg-blue-100 text-blue-700
          {% elif m.status == 'blocked' %}bg-red-100 text-red-700
          {% else %}bg-gray-100 text-gray-600{% endif %}">
          {{ m.status.replace('_',' ') }}
        </span>
      </li>
      {% endfor %}
      {% if not project.milestones %}
      <li class="py-2 text-gray-500 text-center">No milestones added yet</li>
      {% endif %}
    </ul>
  </section>

  <!-- Credentials Snapshot (masked) -->
  <section class="bg-white border p-5 rounded-2xl shadow-sm">
    <h2 class="text-lg font-bold text-gray-900 mb-3">Saved Integrations</h2>
    <div class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">

      <!-- Stripe -->
      <div class="p-3 border rounded-xl bg-gray-50">
        <div class="font-semibold flex justify-between">Stripe <span>{% if creds.stripe_pk %}✔{% else %}—{% endif %}</span></div>
        <p class="text-xs text-gray-500 font-mono">pk: {{ creds.stripe_pk[:8] + "••••" if creds.stripe_pk else "—" }}</p>
      </div>

      <!-- OpenAI -->
      <div class="p-3 border rounded-xl bg-gray-50">
        <div class="font-semibold flex justify-between">OpenAI <span>{% if creds.openai_key %}✔{% else %}—{% endif %}</span></div>
        <p class="text-xs text-gray-500 font-mono">key: {{ creds.openai_key[:8] + "••••••" if creds.openai_key else "—" }}</p>
      </div>

      <!-- Twilio -->
      <div class="p-3 border rounded-xl bg-gray-50">
        <div class="font-semibold flex justify-between">Twilio <span>{% if creds.twilio_sid %}✔{% else %}—{% endif %}</span></div>
        <p class="text-xs text-gray-500 font-mono">sid: {{ creds.twilio_sid[:8] + "••••" if creds.twilio_sid else "—" }}</p>
      </div>

      <!-- Domain -->
      <div class="p-3 border rounded-xl bg-gray-50">
        <div class="font-semibold flex justify-between">Domain <span>{% if project.live_domain %}✔{% else %}—{% endif %}</span></div>
        <p class="text-xs text-gray-500 font-mono">{{ project.live_domain or "—" }}</p>
      </div>

    </div>
  </section>

  <!-- Webhook Events Summary -->
  <section class="bg-white border p-5 rounded-2xl shadow-sm">
    <h2 class="text-lg font-bold text-gray-900 mb-3">Recent Stripe Events</h2>
    <ul class="divide-y divide-dashed text-sm">
      {% for e in webhooks %}
      <li class="py-2">
        <div class="font-semibold text-gray-900 capitalize">{{ e.event_type.replace('.',' ').replace('_',' ') }}</div>
        <span class="text-xs px-2 py-1 rounded-full font-bold
          {% if e.status=='success' %}bg-green-100 text-green-700
          {% elif e.status=='failed' %}bg-red-100 text-red-700
          {% elif e.status=='warning' %}bg-amber-100 text-amber-700
          {% else %}bg-blue-100 text-blue-700{% endif %}">
          {{ e.status }}
        </span>
        <span class="text-xs text-gray-500 ml-2">{{ e.received_at.strftime('%b %d, %H:%M') }}</span>
      </li>
      {% endfor %}
      {% if not webhooks %}
      <li class="py-2 text-gray-500 text-center">No recent events</li>
      {% endif %}
    </ul>

    <!-- Pagination -->
    <div class="flex justify-center items-center gap-3 mt-5 text-sm">
      <a href="?page={{ page-1 }}" class="px-3 py-1 bg-gray-200 text-gray-600 rounded-lg hover:bg-gray-300 transition {% if page<=1 %}pointer-events-none opacity-50{% endif %}">Prev</a>
      {% for i in range(1, total_pages+1) %}
        <a href="?page={{ i }}" class="px-2 {% if i==page %}text-blue-600 font-extrabold{% else %}text-gray-500{% endif %}">{{ i }}</a>
      {% endfor %}
      <a href="?page={{ page+1 }}" class="px-3 py-1 bg-gray-200 text-gray-600 rounded-lg hover:bg-gray-300 transition {% if page>=total_pages %}pointer-events-none opacity-50{% endif %}">Next</a>
    </div>
  </section>

</div>
{% endblock %}
